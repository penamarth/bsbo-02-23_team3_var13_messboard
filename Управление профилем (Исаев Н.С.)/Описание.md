# Модель Use Case: Управление профилем

## Контекст
**Рамки:** Приложение электронной доски объявлений  
**Уровень:** Задача, определенная пользователем  

## Основные исполнители
- **Зарегистрированный пользователь** (Покупатель или Продавец)
- **Незарегистрированный Пользователь** (Гость)

## Заинтересованные лица и их требования

### Пользователь (Покупатель/Продавец)
- Полный контроль над персональными данными
- Управление настройками приватности и уведомлений
- Управление объявлениями, историей транзакций
- Точное отображение локации для объявлений

### Незарегистрированный Пользователь (Гость)
- Быстрая и простая регистрация
- Указание геолокации для релевантных объявлений

### Система
- Актуальные и достоверные данные пользователя
- Обеспечение работоспособности сервисов (доставки, уведомлений, платежей)
- Модерация, аналитика и геолокационный поиск

### Компания
- Повышение доверия к платформе через безопасность и контроль
- Увеличение конверсии регистрации за счет простоты процесса

## Предусловия
- **Для управления профилем:** Пользователь зарегистрирован и аутентифицирован
- **Для регистрации:** Пользователь не аутентифицирован

## Результаты (Постусловия)
- **Для регистрации:** Создан новый аккаунт, пользователь аутентифицирован
- **Для управления профилем:** Данные профиля успешно обновлены и сохранены

---

# Use Case: Регистрация нового пользователя

## Основной успешный сценарий

1. Пользователь нажимает "Зарегистрироваться" или "Создать аккаунт"
2. Система отправляет запрос к серверу, загружает форму регистрации и отображает её с полями:
   - Имя
   - Email
   - Пароль
   - Подтверждение пароля
3. Система выполняет запрос к Geolocation API браузера, запрашивая разрешение на доступ к геолокации
4. Пользователь предоставляет разрешение
5. Система отправляет геоданные в сервис геокодирования, автоматически определяет и заполняет "Город" и "Регион"
6. Пользователь при необходимости корректирует адрес
7. Пользователь нажимает "Зарегистрироваться"
8. Система отправляет запрос к базе данных, проверяя данные на корректность и уникальность Email
9. Система выполняет запрос на создание записи в базе данных, создавая учетную запись с геолокацией
10. Система создает сессию пользователя в базе данных, автоматически аутентифицируя пользователя
11. Система отправляет запрос к сервису email-рассылок, отправляя приветственное письмо с подтверждением регистрации

## Альтернативные потоки

### 3а. Пользователь отказывается от геолокации
- Система загружает из базы данных список доступных городов, отображая обязательное поле "Город" для ручного ввода
- Сценарий продолжается с п.6

### 5а. Система не смогла определить местоположение
- Система логирует ошибку геолокации в базу данных, отображая обязательное поле "Город" для ручного ввода
- Сценарий продолжается с п.6

### 8а. Данные не прошли валидацию
- Система возвращает ошибки валидации из базы данных, отображая сообщение об ошибке с указанием проблемы
- Сценарий возвращается к п.2

### 8б. Пользователь с таким Email уже существует
- Система проверяет наличие email в базе данных, отображая "Пользователь с таким email уже зарегистрирован. Войти?"
- Сценарий возвращается к п.2

---

# Use Case: Редактирование персональной информации

## Основной успешный сценарий

1. Пользователь входит в личный кабинет и нажимает "Управление профилем"
2. Система отправляет запрос к базе данных и загружает текущие данные пользователя, отображая их в редактируемой форме
3. Пользователь изменяет необходимые поля (имя, телефон, email, аватар)
4. Пользователь нажимает "Изменить местоположение"
5. Система загружает из кэша предыдущие локации пользователя, предлагая: "Определить автоматически" или "Ввести вручную"
6. Пользователь выбирает "Определить автоматически"
7. Система отправляет запрос к Geolocation API, запрашивая разрешение на геолокацию и обновляя поля
8. Пользователь нажимает "Сохранить"
9. Система выполняет валидацию данных через сервер, проверяя данные на корректность
10. Система отправляет UPDATE запрос к базе данных, сохраняя обновленные данные
11. Система добавляет задачу в очередь уведомлений, отправляя уведомление об изменении данных
12. Система обновляет кэш пользовательских данных, отображая сообщение об успешном обновлении

## Альтернативные потоки

### 2а. Изменение настроек уведомлений
- Пользователь выбирает вкладку "Настройки уведомлений"
- Система загружает текущие настройки уведомлений из базы данных, отображая события для уведомлений (SMS, email, Push):
  - Новые сообщения
  - Продажи
  - Изменение статуса заказа
  - Рекламные рассылки
- Пользователь включает/выключает опции
- Система сохраняет изменения настроек в базе данных
- Сценарий продолжается с п.4

### 2б. Управление объявлениями
- Пользователь выбирает вкладку "Мои объявления"
- Система отправляет запрос к базе данных объявлений, отображая список активных, неактивных и ожидающих объявлений
- Пользователь может: "Редактировать", "Снять с публикации", "Удалить"
- Система выполняет соответствующие запросы к базе данных при каждом действии

### 2в. Изменение геолокации вручную
- На шаге 5 пользователь выбирает "Ввести вручную"
- Система загружает карту и список городов из внешнего API, отображая поля для ввода и интерактивную карту
- Пользователь вводит адрес или выбирает точку на карте
- Система отправляет выбранные координаты в сервис геокодирования для преобразования в адрес
- Сценарий продолжается с п.8

### 7а. Не удалось определить геолокацию
- Система фиксирует ошибку геолокации в логах, отображая: "Не удалось определить ваше местоположение. Введите вручную"
- Сценарий переходит к расширению 2в

### 9а. Данные не прошли валидацию
- Система возвращает ошибки серверной валидации, отображая сообщение об ошибке с указанием проблемы
- Сценарий возвращается к п.3

### 9б. Email уже существует в системе
- Система проверяет уникальность email в базе данных, отображая: "Пользователь с таким email уже зарегистрирован"
- Сценарий возвращается к п.3

---

## Специальные требования

### Интерфейс и удобство
- Простой и интуитивно понятный интерфейс
- Процесс регистрации не более 1 минуты
- Сохранение изменений профиля до 3 секунд в 95% случаев

### Безопасность и конфиденциальность
- Шифрование персональных данных
- Подтверждение критичных данных через код
- Защищенные каналы связи (SSL/TLS)
- Обезличенное хранение точных координат

### Технические требования
- Система кэширует часто запрашиваемые данные для повышения производительности
- Поддержка форматов аватаров: JPG, PNG, WEBP с автоматическим сжатием
- Использование Geolocation API и сервисов геокодирования
- Точность геолокации до города/района
- Все запросы к базе данных должны логироваться для отладки и аудита

## Открытые вопросы
1. Вводить ли двухфакторную аутентификацию для доступа к настройкам?
2. Как долго хранить историю изменений персональных данных?
3. Предоставлять ли возможность полного удаления аккаунта (GDPR)?
4. Как часто обновлять геолокацию пользователя?
5. Делать ли местоположение публично видимым в профиле?
