### **Рамки.** Приложение электронной доски объявлений.

### **Уровень.** Задача, определенная пользователем.

### **Основной исполнитель.** Зарегистрированный пользователь (покупатель).

### **Заинтересованные лица и их требования:**

- **Покупатель (зарегистрированный пользователь).** Хочет быстро и безопасно оплатить покупку товара, получив подтверждение об успешной транзакции и ожидаемой доставке.
- **Продавец (зарегистрированный пользователь).** Хочет получить уведомление о покупке и средства на свой счет после успешной транзакции.
- **Система платежей.** Хочет корректно обработать платеж, обеспечив безопасность транзакции.
- **Компания.** Хочет генерировать доход от комиссии за успешные сделки и обеспечивать удовлетворенность пользователей.

### **Предусловия:**

- И покупатель, и продавец зарегистрированы и аутентифицированы в системе.
- Продавец уже разместил свое объявление с товаром, который доступен для покупки.

### **Результаты (Постусловия):**

- Покупатель успешно оплатил товар и получил подтверждение об оплате и доставке.
- Продавец получил уведомление о покупке и ожидает перевода средств.
- Платеж успешно обработан и зафиксирован.
- Система обновила соответствующие данные для учета и статистики.

### **Основной успешный сценарий:**

1. **Создание заказа:**
  - **Покупатель** нажимает кнопку "Оформить заказ" на странице просмотра корзины

2. Предлагается выбор способа получения товара
  - После успешной оплаты (шаг 7 основного сценария) **графический интерфейс** отображает варианты: самовывоз, доставка через сторонний сервис

3. Выбор и оформление доставки:
  - **Покупатель** выбирает "Доставка через сторонний сервис"
  - **Графический интерфейс** предоставляет список доступных служб доставки из своей базы данных, каждая из которых доступна через **адаптер службы доставки**, обеспечивающий единый интерфейс для разных API
  - **Покупатель** выбирает службу доставки
  - **Графический интерфейс** форму ввода адреса доставки

4. **Сервер** использует соответствующий **адаптер службы доставки** для отправки запроса в API выбранной службы. Адаптер преобразует внутренние данные системы в формат, требуемый конкретным API:
  - Габариты и вес товара
  - Адрес отправления (от **продавца**)
  - Адрес получения (**покупателя**)
  - Стоимость товара (для страховки)

5. Расчет стоимости и сроков
  - **Служба доставки** возвращает расчет в своем формате, который **адаптер** преобразует в стандартный внутренний формат системы: стоимость доставки, сроки доставки, варианты доставки (курьер, пункт выдачи)

6. Оплата
  - Информация о сумме заказа, **продавце** и **покупателе** передается внешней системе оплаты.
  
7. Генерация чека
  - **Сервер** формирует чек, включая данные о доставке и оплате.

### **Расширения (альтернативные потоки):**

- **1а.** Покупатель хочет задать вопрос продавцу перед покупкой.
  1. **Покупатель** выбирает опцию "Задать вопрос".
  2. **Пользовательский интерфейс** перенаправляет покупателя в чат с продавцом для уточнения деталей.
  3. **Покупатель** после получения ответа может вернуться к процессу оформления.

- **1а.** Товар больше недоступен (например, был продан другому пользователю).
  1. **Сервер** уведомляет покупателя о том, что товар больше недоступен.
  2. **Покупатель** может выбрать другой товар или прекратить покупку.

- **3а.** Покупатель выбирает самовывоз
  1. **Покупатель** входит в диалог с **продавцом** о месте, где **продавец** отдаст заказ.

- **4а.** Сбой доставки.
  1. **Сервер** повторяет запрос через экспоненциальную задержку, используя тот же **адаптер службы доставки** для повторного вызова API.

- **6а.** Платеж не прошел успешно.
  1. **Система платежей** уведомляет об ошибке платежа.
  2. **Сервер** информирует покупателя о неудачной попытке оплаты.
  3. **Покупатель** может попробовать снова или выбрать другой способ оплаты.

- **7а.** Связь с системой платежей потеряна.
  1. **Сервер** уведомляет покупателя о технической проблеме.
  2. **Покупатель** может повторить попытку позже.

### **Специальные требования:**

- Интерфейс должен быть интуитивно понятным и доступным для пользователей с разным уровнем технической подготовки.
- Система должна обеспечивать безопасность обработки персональных и платежных данных.
- Операция оплаты должна занимать не более 2 минут в 95% случаев.
- Возможность локализации интерфейса на разные языки.
- Поддержка различных способов оплаты (банковские карты, электронные кошельки и т.д.).

### **Список технологий и типов данных:**

- **6а.** Платежные данные вводятся через защищенное соединение (SSL/TLS).
- **Платежные системы** и **системы доставки** интегрированы через API и поддерживают стандартные протоколы безопасности.

### **Частота использования:**

- Ожидается высокая частота использования, особенно в пиковые часы активности пользователей.

### **Открытые вопросы:**

- Какие дополнительные способы оплаты следует поддерживать?
- Требуется ли модерация покупателей для предотвращения мошенничества?
- Как обрабатывать случаи возврата средств при спорных ситуациях?
