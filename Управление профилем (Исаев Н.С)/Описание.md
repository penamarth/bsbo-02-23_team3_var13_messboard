# Модель Use Case: Управление профилем пользователя

## Контекст
**Рамки:** Приложение электронной доски объявлений  
**Уровень:** Задача, определенная пользователем  

## Основные исполнители
- **Зарегистрированный пользователь** (Покупатель или Продавец)
- **Незарегистрированный Пользователь** (Гость)

## Заинтересованные лица и их требования

### Пользователь (Покупатель/Продавец)
- Полный контроль над персональными данными
- Управление настройками приватности и уведомлений
- Управление объявлениями, историей транзакций
- Точное отображение локации для объявлений

### Незарегистрированный Пользователь (Гость)
- Быстрая и простая регистрация
- Указание геолокации для релевантных объявлений

### Система
- Актуальные и достоверные данные пользователя
- Обеспечение работоспособности сервисов (доставки, уведомлений, платежей)
- Модерация, аналитика и геолокационный поиск

### Компания
- Повышение доверия к платформе через безопасность и контроль
- Увеличение конверсии регистрации за счет простоты процесса

## Предусловия
- **Для управления профилем:** Пользователь зарегистрирован и аутентифицирован
- **Для регистрации:** Пользователь не аутентифицирован

## Результаты (Постусловия)
- **Для регистрации:** Создан новый аккаунт, пользователь аутентифицирован
- **Для управления профилем:** Данные профиля успешно обновлены и сохранены

---

# Use Case: Управление профилем пользователя

## Основной успешный сценарий

### Регистрация нового пользователя
1. Пользователь нажимает "Зарегистрироваться" или "Создать аккаунт"
2. В UI отображается форма для регистрации пользователя.
3. Система выполняет запрос к Geolocation API браузера, запрашивая разрешение на доступ к геолокации
4. Пользователь предоставляет разрешение
5. Система автоматически определяет и заполняет "Город" и "Регион"
6. Пользователь при необходимости корректирует адрес
7. Пользователь нажимает "Зарегистрироваться"
8. Система отправляет запрос к базе данных, проверяя данные на корректность и уникальность Email
9. Система выполняет запрос на создание записи в базе данных, создавая учетную запись с геолокацией
10. Система создает сессию пользователя в базе данных, автоматически аутентифицируя пользователя
11. Система отправляет запрос к сервису email-рассылок, отправляя приветственное письмо с подтверждением регистрации

## Альтернативные потоки

**1а. Пользователь уже имеет аккаунт и нажимает на кнопку "Войти в систему"**
- Пользователь вводит свой логин и пароль
- Система сверяет введенные данные с данными из базы данных
- Пользователь входит в личный кабинет и нажимает "Управление профилем"
- Система отправляет запрос к базе данных и загружает текущие данные пользователя, отображая их в редактируемой форме
- Пользователь изменяет необходимые поля (имя, телефон, email, аватар)
- Пользователь нажимает "Изменить местоположение"
- Пользователь выбирает "Определить автоматически"
- Система отправляет запрос к Geolocation API, запрашивая разрешение на геолокацию и обновляя поля
- Пользователь нажимает "Сохранить"
- Система выполняет валидацию данных через сервер, проверяя данные на корректность 
- Система добавляет задачу в очередь уведомлений, отправляя уведомление об изменении данных
- Система обновляет кэш пользовательских данных, отображая сообщение об успешном обновлении

**Пользователь хочет удалить свой аккаунт**
- Пользователь входит в личный кабинет и нажимает "Управление профилем"
- Пользователь нажимает "Удалить аккаунт"
- Система отображает предупреждение о последствиях удаления
- Система запрашивает подтверждение через email или ввод пароля
- Пользователь подтверждает удаление
- Система отправляет запрос на удаление всех объявлений пользователя
- Система отправляет запрос на удаление аккаунта из базы данных
- Система выполняет выход пользователя и перенаправляет на главную страницу
- Система отображает сообщение об успешном удалении аккаунта

### Валидация данных
**8а. Данные не прошли валидацию при регистрации**
- Система отображает сообщение об ошибке с указанием проблемы
- Сценарий возвращается к п.2

**8б. Пользователь с таким Email уже существует при регистрации**
- Система проверяет наличие email в базе данных, отображая информацию о наличии пользователя с указанным Email
- Сценарий возвращается к п.2

** Данные не прошли валидацию при редактировании**
- Система возвращает ошибки серверной валидации, отображая сообщение об ошибке с указанием проблемы
- Сценарий возвращается к п.14

---

## Специальные требования

### Интерфейс и удобство
- Простой и интуитивно понятный интерфейс
- Процесс регистрации не более 1 минуты
- Сохранение изменений профиля до 3 секунд в 95% случаев

### Безопасность и конфиденциальность
- Шифрование персональных данных
- Подтверждение критичных данных через код
- Защищенные каналы связи (SSL/TLS)
- Обезличенное хранение точных координат

### Технические требования
- Система кэширует часто запрашиваемые данные для повышения производительности
- Поддержка форматов аватаров: JPG, PNG, WEBP с автоматическим сжатием
- Использование Geolocation API и сервисов геокодирования
- Точность геолокации до города/района
- Все запросы к базе данных должны логироваться для отладки и аудита

## Открытые вопросы
1. Вводить ли двухфакторную аутентификацию для доступа к настройкам?
2. Как долго хранить историю изменений персональных данных?
3. Предоставлять ли возможность полного удаления аккаунта (GDPR)?
4. Как часто обновлять геолокацию пользователя?
5. Делать ли местоположение публично видимым в профиле?
