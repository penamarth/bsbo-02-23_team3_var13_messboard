@startuml
actor Покупатель
participant "UI" as UI
participant "MessageBoardFacade" as Facade
participant "ICartRepository" as CartRepo
participant "Database" as DB
participant "NotificationService" as NotifyService

Покупатель -> UI: Открывает каталог объявлений
UI -> Facade: Search(query: String)
Facade --> UI: List<Advertisement>
UI --> Покупатель: Показывает объявления

loop Добавление объявлений в корзину
    Покупатель -> UI: Нажимает "Добавить в корзину" (advertisementId: uInt32)
    UI -> Facade: AddToCart(userId: uInt32, advertisementId: uInt32)
    Facade -> CartRepo: FindByUserId(userId: uInt32)
    CartRepo -> DB: SELECT * FROM carts WHERE user_id = userId
    DB --> CartRepo: Cart data
    CartRepo --> Facade: List<Advertisement>
    Facade -> Facade: Добавляет объявление в корзину (если отсутствует)
    Facade -> CartRepo: Update(userId: uInt32, advertisement: Advertisement)
    CartRepo -> DB: UPDATE carts SET items = ... WHERE user_id = userId
    DB --> CartRepo: Updated
    CartRepo --> Facade: List<Advertisement>
    Facade -> NotifyService: sendNotification(userId: uInt32, "Объявление добавлено в корзину")
    NotifyService --> Покупатель: Уведомление (toast/SMS/email)
    Facade --> UI: Confirmation
    UI --> Покупатель: Подтверждение добавления (toast "Добавлено в корзину")
end

Покупатель -> UI: Переходит во вкладку "Корзина"
UI -> Facade: GetCart(userId: uInt32)
Facade -> CartRepo: FindByUserId(userId: uInt32)
CartRepo -> DB: SELECT * FROM carts WHERE user_id = userId
DB --> CartRepo: Cart data
CartRepo --> Facade: List<Advertisement>
Facade --> UI: List<Advertisement>
UI --> Покупатель: Показывает список объявлений в корзине

@enduml
